function ShowPage(a){GetPageCount(function(b){if(b<a)return;document.getElementById("itemcount").innerHTML=a+"/"+b+"é¡µ";var c=$(".note_common");c.length>0?$(".note_common").fadeOut("slow",function(){$(".note_common").remove(),$("#removenotes").slideUp("slow"),ListWordPageList(a)}):ListWordPageList(a)})}function addWordUnit(a){var b=getColor();stickynote=$('<div class="note_common '+b+'"/>').appendTo($("#main")),addPin(stickynote);if(a.sound!=""){var c=$("<div/>",{align:"center",mouseover:function(){myplaysound(a.sound,chinesetottsurl(a.chinese))}}),d=$("<img/>",{src:"../../img/wordcard/message.png"});d.appendTo(c),$(c).css({position:"absolute",top:0,right:20}).prependTo($(stickynote))}$(stickynote).append($("<h2>Sticky Note</h2>")),$(stickynote).append($("<p>Text here...</p>")),$(stickynote).append($('<span id="idf_'+a.word+'" />'));var e=a.word+"("+a.count+")",f=a.chinese;$(stickynote).find("h2").html(stripTags(e,allowed_tags)),$(stickynote).find("p").html(stripTags(f,allowed_tags)),$(".note_common").css({width:stickywidth+"px",height:stickyheight+"px"}),$(".note_common p").css({height:stickyheight-60+"px",width:stickywidth+9+"px"})}var currentpage=1,PAGE_SIZE=8,bgPage=chrome.extension.getBackgroundPage(),stickywidth=200,stickyheight=200,max_notes=500,allowed_tags="<br /><br><ol></ol><ul></ul><li></li><strong></strong><i></i><a *></a>",note_index=0;nohtml5=function(){showMessage("#FFE16B","black","Your browser does not support html5, please upgrade your browser.")},getIdentifier=function(a){var b=$(a).closest(".bignote").find("[id^=idf_]").attr("id");if(typeof b=="undefined"||b==null)b=$(a).closest(".note_common").find("[id^=idf_]").attr("id");return typeof b!="undefined"?(b=b.replace("idf_",""),b):!1},deleteNote=function(a){addNewWordUnit(currentpage);var b=getIdentifier($(a));RemoveWord(b),$(a).closest(".note_common").fadeOut("slow",function(){$(a).closest(".note_common").remove(),!$(".note_common").length>0&&$("#removenotes").slideUp("slow")})},closeNote=function(a){$(a).closest(".bignote")[getAnimation(!0)]("slow",function(){$("#overlay").remove()})},getDateTime=function(){var a=new Date,b=a.getMonth()+1,c=a.getDate(),d=a.getFullYear(),e=a.getHours(),f=a.getMinutes(),g="",h=" ",i="/",j=":";return f<10&&(f="0"+f),e>11?g="PM":g="AM",b+i+c+i+d+h+e+j+f+h+g},getISODateTime=function(a){function b(a){return a<10?"0"+a:a}return a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"Z"},editNote=function(a,b){var c=a.find("p").html();c=c.replace(/(<br \/>|<br>)/g,"\n"),c=c.replace(/(<ol>|<li>)/g,""),c=c.replace(/(<\/ol>|<\/li>)/g,"\n"),a.find("p").replaceWith('<textarea class="pedit"  readonly="readonly" />'),a.find(".pedit").val(c).css("margin-top","5px").addClass("inset").width("590px").height("280px");var d=a.find("h2").text();a.find("h2").replaceWith('<input type="text" class="hedit" readonly="readonly" />'),$(".hedit").addClass("inset").val(stripTags(d,allowed_tags)).width(250),$('<a href="#" class="close_stickynote"><img src="../../img/wordcard/deletebig.png" alt="" title="close note"></a>').css({position:"absolute",top:7,right:5}).appendTo(a)},emailNote=function(){},shareNote=function(){},shrink=function(){var a=0+parseInt($(".note_common:first").find("h2").height(),10)+"px";$(".note_common").animate({height:a},function(){$(".note_common").find("p").hide()})},expand=function(){$(".note_common").animate({height:stickyheight},function(){$(".note_common").find("p").fadeIn("slow")})},showMessage=function(a,b,c){$("#smsg").is(":visible")||$("html, body").animate({scrollTop:0},500,function(){$("#smsg").length||($('<div id="smsg">'+c+"</div>").appendTo($("body")).css({position:"absolute",top:0,left:3,width:"98%",height:"30px",lineHeight:"30px",background:a,color:b,zIndex:1e3,padding:"10px",fontWeight:"bold",textAlign:"center",opacity:.9,margin:"auto",display:"none"}).slideDown("show"),setTimeout(function(){$("#smsg").animate({width:"hide"},function(){$("#smsg").remove()})},4e3))})},getColor=function(){var a="",b="0123456789";return a+=b.charAt(Math.floor(Math.random()*b.length)),"stickynote"+a},getAnimation=function(a){var b=new Array;typeof a!="undefined"?(b[1]="hide",b[2]="fadeOut",b[3]="slideUp"):(b[1]="show",b[2]="fadeIn",b[3]="slideDown");var c=Math.ceil(Math.random()*3);return b[c]},addPin=function(a){var b=$('<div><a href="#" class="delete_stickynote"><img src="../../img/wordcard/delete.png" alt="" title="delete note"></a></div>'),c=$('<div align="center"><img src="../../img/wordcard/pin.png" alt=""></div>');$(b).css({position:"absolute",top:-15,right:-15}).prependTo($(a)),$(c).css({position:"absolute",zIndex:99,top:-30,left:parseInt(stickywidth/2,10)-10}).prependTo($(a))},enlargeNote=function(a){$this=$(a);var b=parseInt($(a).offset().left,10),c=parseInt($(a).offset().top,10);$('<div id="overlay" />').css({position:"fixed",background:"transparent",background:"rgba(0,0,0,0.5)",top:"0",left:"0",width:"100%",height:"100%",zIndex:"100"}).appendTo($("body")),$clone=$(a).clone().removeClass("note_common").addClass("bignote").appendTo($("#overlay")),$clone.find($('img[src*="pin.png"]').closest("div")).hide(),$clone.find($('img[src*="delete.png"]').closest("div")).hide(),$($clone).css({position:"absolute",zIndex:500,cursor:"default",paddingTop:"5px",top:c,left:b,width:"600px",height:"400px",top:"50%",left:"50%",display:"none",marginLeft:"-300px",marginTop:"-200px"}),$($clone)[getAnimation()](400);var d="",e="",f=getIdentifier($(a)),g=getCtime(f),h='<img class="left" align="absmiddle" src="../../img/wordcard/time.png">';d=g.split("|")[0],d=d.length>0?"Created on: "+d:"",e=e.length>0?" ("+e+")":"",h=d.length>0?h:"",$('<div class="timeago left" />').prependTo($clone),$(".timeago").css({fontSize:"12px",fontFamily:"tahoma"}).html(h+"&nbsp;&nbsp;"+d+e),$(".timeago").after('<div class="clear" />'),$($clone).find(".icons-footer").hide(),editNote($clone,a)},setup=function(){var a=$(".note_common p").css("font-family");typeof a!="undefined"&&a.indexOf("Architects")>=0&&($(".note_common ul").css({lineHeight:"10px",padding:"0px",margin:"0px"}),$(".note_common ol").css({lineHeight:"0px",padding:"0px",margin:"0px"})),stickywidth<200&&(stickywidth=200),stickyheight<200&&(stickyheight=200),$("#cishu").bind("click",function(a){SetOrder()}),$("#zimu").bind("click",function(a){SetOrder()}),$("#jiangxu").bind("click",function(a){SetOrder()}),$("#shengxu").bind("click",function(a){SetOrder()}),$("#prevpage").bind("click",function(a){ShowPrevPage()}),$("#nextpage").bind("click",function(a){ShowNextPage()})},stripTags=function(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,d=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return a.replace(d,"").replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""})},$(document).ready(function(){localStorage.rdOrderKey||(localStorage.rdOrderKey="count"),localStorage.rdOrder||(localStorage.rdOrder="desc"),SetGroupValue("rdOrderKey",localStorage.rdOrderKey),SetGroupValue("rdOrder",localStorage.rdOrder),setup(),$(".delete_stickynote").live("click",function(){return deleteNote($(this)),!1}),$(".close_stickynote").live("click",function(){return closeNote($(this)),!1}),$(".note_common").live("click",function(a){enlargeNote($(this))}),$("#shrink").click(function(a){shrink()}),$("#expand").click(function(a){expand()}),$(document).keyup(function(a){a.keyCode=="27"&&($("#overlay").remove(),$(".bignore").remove())}),ShowPage(currentpage),UpdateWordCounts(),$("body").gesture(function(a){var b=a.getName();b=="right"?ShowNextPage():b=="left"&&ShowPrevPage()})});